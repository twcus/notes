<div class="toolbar">
    <div class="toolbar-actions">
        <div class="toolbar-item">
            <Select::DropdownSelect
                    @options={{this.viewModeOptions}}
                    @selected={{this.viewMode}}
                    @onOpen={{this.onTagSelectorOpen}}
                    @onClose={{this.onTagSelectorClose}}
                    @onSelect={{this.selectViewMode}}
                    @searchEnabled={{false}}
                    @displayProperty="name"
                    @stopPropagation={{true}}
            >
                <FaIcon @icon={{this.viewMode.icon}} @fixedWidth={{true}} />
            </Select::DropdownSelect>
        </div>
        <div class="toolbar-item">
            <div class="search-container">
                <FaIcon @icon="search" />
                <Input type="text" placeholder="Search" aria-label="Search notes" @value={{this.searchQuery}} />
            </div>
        </div>
        <div class="toolbar-item">
            <Select::DropdownSelect
                    @isMultiselect={{true}}
                    @options={{this.model.tags}}
                    @selected={{this.tagFilters}}
                    @onSelect={{this.updateTagFilters}}
                    @searchEnabled={{true}}
                    @displayProperty="content"
                    @placeholder="Enter tag"
                    @searchField="content"
                    @stopPropagation=true
                    @showCreateOption={{true}}
            >
                <FaIcon class="has-margin-right" @icon="filter" /><span>Filter</span>
            </Select::DropdownSelect>
        </div>
        <div class="toolbar-item">
            <Utils::SortSelect
                    @sortPropertyOptions={{this.sortOptions}}
                    @selectedSortProperty={{this.sortProperty}}
                    @onSelectSortProperty={{this.selectSortProperty}}
                    @onSelectSortOrder={{this.selectSortOrder}}
                    @defaultSortOrder={{this.defaultSortOrder}}
            />
        </div>
        {{#unless this.isCollection}}
            <div class="toolbar-item">
                <button class="button outline fill"><FaIcon @class="has-margin-right" @icon="bookmark" /><span>New Collection</span></button>
                <AttachPopover
                        @animation="shift"
                        @hideDelay=0
                        @hideDuration=300
                        @hideOn="click clickout escapekey"
                        @interactive={{true}}
                        @isShown={{false}}
                        @placement="bottom"
                        @showDelay=0
                        @showDuration=300
                        @showOn="click"
                        @class="popover-container"
                        as |popover|
                >
                    <span class="title">Save as new collection</span>
                    {{#if this.collectionError}}
                        <span class="error">{{this.collectionError}}</span>
                    {{/if}}
                    <Input @placeholder="Collection name" aria-label="Search notes" @value={{this.collectionName}} />
                    <div class="action-bar">
                        <button class="button text" {{on "click" popover.hide}}>Cancel</button>
                        <button class="button" {{on "click" (fn this.saveCollection popover.hide)}}>Save</button>
                    </div>
                </AttachPopover>
            </div>
        {{/unless}}
        <div class="toolbar-item">
            <LinkTo @tagName="button" class="is-primary is-bold button" @route={{if this.isCollection "collection-notes.new" "notes.new"}}>
                <FaIcon class="has-margin-right" @icon="plus" />
                <span>New Note</span>
            </LinkTo>
        </div>
    </div>
    <div class="tag-list collection-tags">
        {{#each this.collectionTags as |tag|}}
            <Tags::Tag @tag={{tag}} />
        {{/each}}
    </div>
    <div class="tag-list">
        {{#each this.tagFilters as |tag|}}
            <Tags::Tag @tag={{tag}} @onRemove={{this.removeFilteredTag}} />
        {{/each}}
    </div>
</div>
<div class="content">
    {{#if this.firstNoteInOrder}}
        {{component
                (concat "notes/modes/" this.viewMode.component)
                notes=this.sortedNotes
                tags=this.sortedTags
                onNoteDelete=this.onDeleteOpen
                onNoteUpdate=this.updatedNote
                onTagCreate=this.createTagAndAddToNote
                collection=this.model.collection
        }}
    {{else}}
        <NoResultsMessage>
            <span>No Notes Found</span>
        </NoResultsMessage>
    {{/if}}
    {{outlet}}
</div>

{{#if this.isConfirmingDelete}}
    <ConfirmModal
            @class="small"
            @item={{this.noteForDeletion}}
            @header="Delete Collection"
            @buttonLabel="Delete"
            @onClose={{fn this.onDeleteClose false}}
            @onConfirm={{fn this.onDeleteClose true}}
    >
        Are you sure you want to delete this note?
    </ConfirmModal>
{{/if}}
